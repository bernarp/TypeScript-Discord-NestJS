<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# –ö–∞–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç—ã –±—ã –ø—Ä–µ–ª–æ–∂–∏–ª –ø–æ —ç—Ç–∏–º —Ñ–∞–π–ª–∞–º —Å –∫–æ–º–∞–Ω–¥–∞–º–∏?

–ù–∞–ø—Ä–∏–º–µ—Ä
MANAGEABLE_PANELS –∫—É–¥–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å
CONFIGURABLE_SETTINGS —Ç–∞–∫ –∂–µ

–∫—É–¥–∞
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† if (error.code === 10008) {
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† // Unknown Message - —Å–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ —É–¥–∞–ª–µ–Ω–æ
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† messageDeletionError = "–°–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ —Ä–∞–Ω–µ–µ.";
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† } else if (error.code === 10003) {
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† // Unknown Channel
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† messageDeletionError = "–ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω.";
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† } else if (error.code === 50013) {
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† // Missing Permissions
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† messageDeletionError =
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è.";
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† } else {
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† messageDeletionError = \`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ${error.message}\`;
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† }

const panelType = interaction.options.getString(
¬† ¬† ¬† ¬† ¬† ¬† "panel_type",
¬† ¬† ¬† ¬† ¬† ¬† true
–≠—Ç–æ —Ç–æ–∂–µ

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –ê–Ω–∞–ª–∏–∑–∏—Ä—É—è –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–º–∞–Ω–¥, —è –≤–∏–∂—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å. –í–æ—Ç –º–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É:

## 1. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –µ–Ω—É–º—ã

**@constants/panel-types.constants.ts**

```typescript
/**
 * @file panel-types.constants.ts
 * @description –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ç–∏–ø–æ–≤ —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –ø–∞–Ω–µ–ª–µ–π
 * @version 1.0.0
 * @author System
 */

import { IGuildSettings } from "@type/IGuildSettings";

export const MANAGEABLE_PANELS: ReadonlyArray<{
    name: string;
    value: keyof Required<IGuildSettings>["pinnedMessages"];
    description: string;
    emoji?: string;
}> = [
    {
        name: "–ü–∞–Ω–µ–ª—å —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤",
        value: "ticketCreatePanel",
        description: "–ü–∞–Ω–µ–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏",
        emoji: "üé´",
    },
    {
        name: "–ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–µ–π",
        value: "roleSelectPanel",
        description: "–ü–∞–Ω–µ–ª—å –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–µ–π",
        emoji: "üé≠",
    },
] as const;

export type PanelType = (typeof MANAGEABLE_PANELS)[number]["value"];
```

**@constants/config-settings.constants.ts**

```typescript
/**
 * @file config-settings.constants.ts
 * @description –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞
 * @version 1.0.0
 * @author System
 */

import { IGuildSettings } from "@type/IGuildSettings";

export const CONFIGURABLE_SETTINGS: ReadonlyArray<{
    key: keyof IGuildSettings;
    name: string;
    description: string;
    category: "logging" | "general" | "features";
}> = [
    {
        key: "logChannelId",
        name: "–ö–∞–Ω–∞–ª –¥–ª—è –ª–æ–≥–æ–≤ –∫–æ–º–∞–Ω–¥",
        description: "–û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥",
        category: "logging",
    },
    {
        key: "logChannelMessageDeleteId",
        name: "–ö–∞–Ω–∞–ª –ª–æ–≥–æ–≤: –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
        description: "–ö–∞–Ω–∞–ª –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π",
        category: "logging",
    },
    {
        key: "logChannelMessageEditId",
        name: "–ö–∞–Ω–∞–ª –ª–æ–≥–æ–≤: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
        description: "–ö–∞–Ω–∞–ª –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π",
        category: "logging",
    },
    {
        key: "logChannelMessageSendId",
        name: "–ö–∞–Ω–∞–ª –ª–æ–≥–æ–≤: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (–°–ü–ê–ú!)",
        description: "–ö–∞–Ω–∞–ª –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π",
        category: "logging",
    },
    {
        key: "logChannelInteractionId",
        name: "–ö–∞–Ω–∞–ª –ª–æ–≥–æ–≤: InteractionCreate",
        description: "–ö–∞–Ω–∞–ª –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π",
        category: "logging",
    },
    {
        key: "welcomeChannelId",
        name: "–ö–∞–Ω–∞–ª –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π",
        description: "–ö–∞–Ω–∞–ª –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤",
        category: "general",
    },
] as const;

export type ConfigSettingKey = (typeof CONFIGURABLE_SETTINGS)[number]["key"];
```

## 2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ Discord API

**@utils/DiscordErrorHandler.ts**

```typescript
/**
 * @file DiscordErrorHandler.ts
 * @description –£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ Discord API
 * @version 1.0.0
 * @author System
 */

import { Injectable } from "@nestjs/common";
import { ILogger } from "@interface/logger/ILogger";

export interface DiscordErrorResult {
    success: boolean;
    errorMessage: string | null;
    errorCode?: number;
}

@Injectable()
export class DiscordErrorHandler {
    constructor(private readonly _logger: ILogger) {}

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
     */
    public handleMessageDeletionError(
        error: any,
        context: string
    ): DiscordErrorResult {
        let errorMessage: string;

        switch (error.code) {
            case 10008: // Unknown Message
                errorMessage = "–°–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ —Ä–∞–Ω–µ–µ.";
                break;
            case 10003: // Unknown Channel
                errorMessage = "–ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω.";
                break;
            case 50013: // Missing Permissions
                errorMessage = "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è.";
                break;
            case 50001: // Missing Access
                errorMessage = "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–Ω–∞–ª—É.";
                break;
            case 10062: // Unknown Interaction
                errorMessage = "–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–ª–æ.";
                break;
            default:
                errorMessage = `–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ${error.message}`;
                break;
        }

        this._logger.warn(`Discord API error in ${context}:`, error.stack);

        return {
            success: false,
            errorMessage,
            errorCode: error.code,
        };
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–∞–Ω–∞–ª–æ–≤
     */
    public handleChannelFetchError(
        error: any,
        channelId: string
    ): DiscordErrorResult {
        let errorMessage: string;

        switch (error.code) {
            case 10003: // Unknown Channel
                errorMessage = "–ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω.";
                break;
            case 50001: // Missing Access
                errorMessage = "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–Ω–∞–ª—É.";
                break;
            default:
                errorMessage = `–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–∞–Ω–∞–ª–∞: ${error.message}`;
                break;
        }

        this._logger.warn(`Failed to fetch channel ${channelId}:`, error.stack);

        return {
            success: false,
            errorMessage,
            errorCode: error.code,
        };
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–æ–π (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏)
     */
    public isCriticalError(errorCode: number): boolean {
        const criticalCodes = [50001, 50013]; // Missing Access, Missing Permissions
        return criticalCodes.includes(errorCode);
    }
}
```

## 3. –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∫–æ–º–∞–Ω–¥

**@commands/base/BaseCommand.ts**

```typescript
/**
 * @file BaseCommand.ts
 * @description –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
 * @version 1.0.0
 * @author System
 */

import { ChatInputCommandInteraction, GuildMember } from "discord.js";
import { IEmbedFactory } from "@interface/utils/IEmbedFactory";
import { IPermissionService } from "@commands/abstractions/IPermissionService";
import { PermissionNode } from "@permissions/permissions.dictionary";

export abstract class BaseCommand {
    constructor(
        protected readonly _embedFactory: IEmbedFactory,
        protected readonly _permissionService: IPermissionService
    ) {}

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤
     */
    protected async checkPermissionWithReply(
        interaction: ChatInputCommandInteraction,
        permission: PermissionNode,
        errorMessage?: string
    ): Promise<boolean> {
        const hasPermission = await this._permissionService.check(
            interaction.member as GuildMember,
            permission
        );

        if (!hasPermission) {
            const errorEmbed = this._embedFactory.createErrorEmbed({
                description:
                    errorMessage ||
                    "–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è.",
                context: { user: interaction.user, guild: interaction.guild },
            });
            await interaction.reply({ embeds: [errorEmbed], ephemeral: true });
        }

        return hasPermission;
    }

    /**
     * –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
     */
    protected getStringOption(
        interaction: ChatInputCommandInteraction,
        name: string,
        required: true
    ): string;
    protected getStringOption(
        interaction: ChatInputCommandInteraction,
        name: string,
        required?: false
    ): string | null;
    protected getStringOption(
        interaction: ChatInputCommandInteraction,
        name: string,
        required = false
    ): string | null {
        return interaction.options.getString(name, required);
    }

    /**
     * –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –∫–∞–Ω–∞–ª
     */
    protected getChannelOption(
        interaction: ChatInputCommandInteraction,
        name: string,
        required: true
    ): NonNullable<
        ReturnType<ChatInputCommandInteraction["options"]["getChannel"]>
    >;
    protected getChannelOption(
        interaction: ChatInputCommandInteraction,
        name: string,
        required?: false
    ): ReturnType<ChatInputCommandInteraction["options"]["getChannel"]>;
    protected getChannelOption(
        interaction: ChatInputCommandInteraction,
        name: string,
        required = false
    ) {
        return interaction.options.getChannel(name, required);
    }

    /**
     * –î–µ—Ñ–µ—Ä –æ—Ç–≤–µ—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
     */
    protected async safeDefer(
        interaction: ChatInputCommandInteraction,
        ephemeral = true
    ): Promise<boolean> {
        try {
            await interaction.deferReply({ ephemeral });
            return true;
        } catch (error) {
            console.error("Failed to defer reply:", error);
            return false;
        }
    }
}
```

## 4. –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞–Ω–µ–ª—è–º–∏

**@services/PanelManagementService.ts**

```typescript
/**
 * @file PanelManagementService.ts
 * @description –°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª—è–º–∏
 * @version 1.0.0
 * @author System
 */

import { Injectable, Inject } from "@nestjs/common";
import { TextChannel } from "discord.js";
import { IClient } from "@interface/IClient";
import { IConfigurationService } from "@interface/config/IConfigurationService";
import { ILogger } from "@interface/logger/ILogger";
import {
    DiscordErrorHandler,
    DiscordErrorResult,
} from "@utils/DiscordErrorHandler";
import { MANAGEABLE_PANELS, PanelType } from "@constants/panel-types.constants";

export interface PanelDeletionResult {
    configDeleted: boolean;
    messageDeleted: boolean;
    error?: string;
}

@Injectable()
export class PanelManagementService {
    constructor(
        @Inject("IClient") private readonly _client: IClient,
        @Inject("IConfigurationService")
        private readonly _configService: IConfigurationService,
        @Inject("ILogger") private readonly _logger: ILogger,
        private readonly _errorHandler: DiscordErrorHandler
    ) {}

    /**
     * –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–Ω–µ–ª–∏ –ø–æ —Ç–∏–ø—É
     */
    public getPanelInfo(panelType: string) {
        return MANAGEABLE_PANELS.find((p) => p.value === panelType);
    }

    /**
     * –£–¥–∞–ª—è–µ—Ç –ø–∞–Ω–µ–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é (–∏–∑ Discord –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
     */
    public async deletePanel(
        guildId: string,
        panelType: PanelType,
        userTag: string
    ): Promise<PanelDeletionResult> {
        const result: PanelDeletionResult = {
            configDeleted: false,
            messageDeleted: false,
        };

        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–Ω–µ–ª–∏ –¥–æ —É–¥–∞–ª–µ–Ω–∏—è
        const guildSettings = await this._configService.guilds.getGuildSettings(
            guildId
        );
        const pinnedMessageConfig = guildSettings?.pinnedMessages?.[panelType];

        // –ü—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ Discord
        if (pinnedMessageConfig) {
            const deletionResult = await this._deleteDiscordMessage(
                pinnedMessageConfig.channelId,
                pinnedMessageConfig.messageId,
                panelType
            );
            result.messageDeleted = deletionResult.success;
            if (!deletionResult.success) {
                result.error =
                    deletionResult.errorMessage || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";
            }
        } else {
            result.error = "–ü–∞–Ω–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.";
        }

        // –£–¥–∞–ª—è–µ–º –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        try {
            await this._configService.guilds.deletePinnedMessage(
                guildId,
                panelType
            );
            result.configDeleted = true;
            this._logger.inf(
                `User ${userTag} deleted configuration for panel '${panelType}'.`
            );
        } catch (error) {
            this._logger.err(
                `Failed to delete panel config for '${panelType}':`,
                error.stack
            );
            result.error = `–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ${error.message}`;
        }

        return result;
    }

    private async _deleteDiscordMessage(
        channelId: string,
        messageId: string,
        panelType: string
    ): Promise<DiscordErrorResult> {
        try {
            const channel = await this._client.channels.fetch(channelId);

            if (!channel || !(channel instanceof TextChannel)) {
                return {
                    success: false,
                    errorMessage:
                        "–ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤—ã–º –∫–∞–Ω–∞–ª–æ–º.",
                };
            }

            const message = await channel.messages.fetch(messageId);
            await message.delete();

            this._logger.inf(
                `Deleted pinned message ${messageId} for panel '${panelType}' in channel ${channelId}.`
            );

            return { success: true, errorMessage: null };
        } catch (error) {
            return this._errorHandler.handleMessageDeletionError(
                error,
                `deletePanel(${panelType})`
            );
        }
    }
}
```

## 5. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ PinnedMessage

**PinnedMessageCommand.ts** (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)

```typescript
/**
 * @file PinnedMessageCommand.ts
 * @description –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è "—Å–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∏–º–∏—Å—è" —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏-–ø–∞–Ω–µ–ª—è–º–∏.
 * @version 2.0.0 (Refactored with new architecture)
 * @author System
 */

import { Inject, Injectable } from "@nestjs/common";
import {
    SlashCommandBuilder,
    CommandInteraction,
    ChatInputCommandInteraction,
    GuildMember,
    ChannelType,
} from "discord.js";
import { Command } from "@decorators/command.decorator";
import { ICommand } from "@interface/ICommand";
import { IEmbedFactory } from "@interface/utils/IEmbedFactory";
import { IPermissionService } from "../abstractions/IPermissionService";
import { Permissions } from "@permissions/permissions.dictionary";
import { EventEmitter2 } from "@nestjs/event-emitter";
import { AppEvents } from "@/event.EventBus/app.events";
import { PinnedMessageMissingEvent } from "@/event.EventBus/pinned-message-missing.event";
import { IConfigurationService } from "@interface/config/IConfigurationService";
import { IGuildSettings } from "@type/IGuildSettings";
import { ILogger } from "@interface/logger/ILogger";
import { BaseCommand } from "@commands/base/BaseCommand";
import { MANAGEABLE_PANELS, PanelType } from "@constants/panel-types.constants";
import { PanelManagementService } from "@services/PanelManagementService";

@Injectable()
@Command()
export class PinnedMessageCommand extends BaseCommand implements ICommand {
    public readonly data = new SlashCommandBuilder()
        .setName("pinned-message")
        .setDescription("–£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∏–º–∏—Å—è –ø–∞–Ω–µ–ª—è–º–∏.")
        .setDMPermission(false)
        .addSubcommand((sub) =>
            sub
                .setName("create")
                .setDescription(
                    "–°–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–∞–Ω–µ–ª—å –≤ –∫–∞–Ω–∞–ª–µ."
                )
                .addStringOption((opt) =>
                    opt
                        .setName("panel_type")
                        .setDescription("–¢–∏–ø –ø–∞–Ω–µ–ª–∏, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å.")
                        .setRequired(true)
                        .addChoices(
                            ...MANAGEABLE_PANELS.map((p) => ({
                                name: p.name,
                                value: p.value,
                            }))
                        )
                )
                .addChannelOption((opt) =>
                    opt
                        .setName("channel")
                        .setDescription(
                            "–ö–∞–Ω–∞–ª, –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç —Ä–∞–∑–º–µ—â–µ–Ω–∞ –ø–∞–Ω–µ–ª—å."
                        )
                        .addChannelTypes(ChannelType.GuildText)
                        .setRequired(true)
                )
        )
        .addSubcommand((sub) =>
            sub
                .setName("delete")
                .setDescription(
                    "–£–¥–∞–ª—è–µ—Ç –ø–∞–Ω–µ–ª—å –∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç –µ–µ –∞–≤—Ç–æ-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ."
                )
                .addStringOption((opt) =>
                    opt
                        .setName("panel_type")
                        .setDescription("–¢–∏–ø –ø–∞–Ω–µ–ª–∏, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å.")
                        .setRequired(true)
                        .addChoices(
                            ...MANAGEABLE_PANELS.map((p) => ({
                                name: p.name,
                                value: p.value,
                            }))
                        )
                )
        );

    constructor(
        @Inject("IEmbedFactory") embedFactory: IEmbedFactory,
        @Inject("IPermissionService") permissionService: IPermissionService,
        @Inject("IConfigurationService")
        private readonly _configService: IConfigurationService,
        @Inject("ILogger") private readonly _logger: ILogger,
        private readonly _eventEmitter: EventEmitter2,
        private readonly _panelService: PanelManagementService
    ) {
        super(embedFactory, permissionService);
    }

    public async execute(interaction: CommandInteraction): Promise<void> {
        if (!interaction.isChatInputCommand() || !interaction.inGuild()) return;

        const hasPermission = await this.checkPermissionWithReply(
            interaction,
            Permissions.ADMIN_ALL,
            "–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª—è–º–∏."
        );

        if (!hasPermission) return;

        const subcommand = interaction.options.getSubcommand();

        switch (subcommand) {
            case "create":
                await this._handleCreate(interaction);
                break;
            case "delete":
                await this._handleDelete(interaction);
                break;
        }
    }

    private async _handleCreate(
        interaction: ChatInputCommandInteraction
    ): Promise<void> {
        if (!(await this.safeDefer(interaction))) return;

        const panelType = this.getStringOption(
            interaction,
            "panel_type",
            true
        ) as PanelType;
        const channel = this.getChannelOption(interaction, "channel", true);

        await this._configService.guilds.deletePinnedMessage(
            interaction.guildId,
            panelType
        );

        this._eventEmitter.emit(
            AppEvents.PINNED_MESSAGE_MISSING,
            new PinnedMessageMissingEvent(
                interaction.guildId,
                panelType,
                channel.id
            )
        );

        this._logger.inf(
            `User ${interaction.user.tag} triggered recreation of panel '${panelType}' in channel ${channel.id}.`
        );

        const panelInfo = this._panelService.getPanelInfo(panelType);
        const successEmbed = this._embedFactory.createSuccessEmbed({
            title: "–ü–∞–Ω–µ–ª—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–æ–∑–¥–∞–Ω–∏—è",
            description: `–ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ **"${
                panelInfo?.name || panelType
            }"** –≤ –∫–∞–Ω–∞–ª–µ ${channel.toString()} –±—ã–ª —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.`,
            context: { user: interaction.user, guild: interaction.guild },
        });

        await interaction.editReply({ embeds: [successEmbed] });
    }

    private async _handleDelete(
        interaction: ChatInputCommandInteraction
    ): Promise<void> {
        if (!(await this.safeDefer(interaction))) return;

        const panelType = this.getStringOption(
            interaction,
            "panel_type",
            true
        ) as PanelType;

        const result = await this._panelService.deletePanel(
            interaction.guildId,
            panelType,
            interaction.user.tag
        );

        const panelInfo = this._panelService.getPanelInfo(panelType);
        let description = `–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞–Ω–µ–ª–∏ **"${
            panelInfo?.name || panelType
        }"** –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞. –°–∏—Å—Ç–µ–º–∞ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –µ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å.\n\n`;

        if (result.messageDeleted) {
            description +=
                "‚úÖ **–°–æ–æ–±—â–µ–Ω–∏–µ —Ç–∞–∫–∂–µ –±—ã–ª–æ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ –∏–∑ Discord.**";
        } else if (result.error) {
            description += `‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –°–æ–æ–±—â–µ–Ω–∏–µ –≤ Discord –Ω–µ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ.\n**–ü—Ä–∏—á–∏–Ω–∞:** ${result.error}`;
        }

        const embed = this._embedFactory.createSuccessEmbed({
            title: "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞–Ω–µ–ª–∏ —É–¥–∞–ª–µ–Ω–∞",
            description: description,
            context: { user: interaction.user, guild: interaction.guild },
        });

        await interaction.editReply({ embeds: [embed] });
    }
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å
2. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** - –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫ –∏ –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–µ–∑–¥–µ
3. **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è —Å TypeScript
4. **–õ–µ–≥–∫–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –ª–µ–≥–∫–æ –º–æ–∫–∞—Ç—å
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
6. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –µ–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫ Discord API

–¢–∞–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º SOLID –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —á–∏—Å—Ç—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –∫–æ–¥.

<div style="text-align: center">‚ÅÇ</div>

[^1]: allTS2.txt
[^2]: PermissionsCommand.ts
[^3]: PinnedMessageCommand.ts
[^4]: ConfigCommand.ts
